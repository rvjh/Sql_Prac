with cte as(
SELECT * FROM malware
WHERE software_id IN (
  SELECT software_id
  FROM malware
  GROUP BY software_id
  HAVING COUNT(*) >= 2))
, cte2 as(
select *
, lag(malware_detected,1) over(partition by software_id order by run_date) prev_mal,
row_number() over(partition by software_id order by run_date desc) rn
from cte)
select software_id, malware_detected as latest_run_count,
(malware_detected - prev_mal) difference_to_previous 
from cte2
where malware_detected >= 10 and rn=1